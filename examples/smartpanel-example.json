[
    {
        "id": "tab_basic_setup",
        "type": "tab",
        "label": "Smartpanel - Basic Setup",
        "disabled": false,
        "info": "# NMOS Smartpanel - Basic Setup\n\nBasic example showing:\n- Smartpanel node configuration\n- Command reception\n- Debug output\n\n## Setup:\n1. Configure nmos-config node with your registry\n2. Set MQTT broker URL\n3. Deploy and test with inject nodes"
    },
    {
        "id": "smartpanel_basic",
        "type": "nmos-smartpanel",
        "z": "tab_basic_setup",
        "name": "Control Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Riedel Smartpanel",
        "deviceDescription": "Production control panel",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": true,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 340,
        "y": 120
    },
    {
        "id": "debug_all",
        "type": "debug",
        "z": "tab_basic_setup",
        "name": "All Commands",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 570,
        "y": 120
    },
    {
        "id": "inject_get_state",
        "type": "inject",
        "z": "tab_basic_setup",
        "name": "Get State",
        "props": [
            {
                "p": "action",
                "v": "get_state",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 140,
        "y": 80
    },
    {
        "id": "inject_history",
        "type": "inject",
        "z": "tab_basic_setup",
        "name": "Get History",
        "props": [
            {
                "p": "action",
                "v": "get_command_history",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 120
    },
    {
        "id": "inject_clear",
        "type": "inject",
        "z": "tab_basic_setup",
        "name": "Clear History",
        "props": [
            {
                "p": "action",
                "v": "clear_history",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 160
    },
    {
        "id": "comment_basic",
        "type": "comment",
        "z": "tab_basic_setup",
        "name": "Basic Smartpanel Setup - Connect to MQTT and Registry",
        "info": "",
        "x": 240,
        "y": 40
    },
    {
        "id": "tab_button_handler",
        "type": "tab",
        "label": "Smartpanel - Button Handler",
        "disabled": false,
        "info": "# Button Press Handler\n\nDemonstrates:\n- Button press detection\n- Camera selection logic\n- Recording control\n- Button state tracking"
    },
    {
        "id": "smartpanel_buttons",
        "type": "nmos-smartpanel",
        "z": "tab_button_handler",
        "name": "Button Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Camera Control Panel",
        "deviceDescription": "4-camera switcher control",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": true,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 250,
        "y": 140
    },
    {
        "id": "func_button_handler",
        "type": "function",
        "z": "tab_button_handler",
        "name": "Button Handler",
        "func": "// Process button commands\nif (!msg.smartpanel || !msg.smartpanel.commands) {\n    return null;\n}\n\nfor (const cmd of msg.smartpanel.commands) {\n    if (cmd.type === 'button' && cmd.pressed) {\n        switch (cmd.button) {\n            case 1:\n            case 2:\n            case 3:\n            case 4:\n                // Camera selection (buttons 1-4)\n                msg.payload = {\n                    action: 'select_camera',\n                    camera: cmd.button,\n                    timestamp: new Date().toISOString()\n                };\n                msg.topic = 'camera/select';\n                return [msg, null, null];\n                \n            case 5:\n                // Record button\n                msg.payload = {\n                    action: 'start_recording',\n                    timestamp: new Date().toISOString()\n                };\n                msg.topic = 'recording/control';\n                return [null, msg, null];\n                \n            case 6:\n                // Stop button\n                msg.payload = {\n                    action: 'stop_recording',\n                    timestamp: new Date().toISOString()\n                };\n                msg.topic = 'recording/control';\n                return [null, msg, null];\n                \n            default:\n                // Unknown button\n                msg.payload = {\n                    button: cmd.button,\n                    pressed: cmd.pressed\n                };\n                return [null, null, msg];\n        }\n    }\n}\n\nreturn null;",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 140
    },
    {
        "id": "debug_camera",
        "type": "debug",
        "z": "tab_button_handler",
        "name": "Camera Select",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 650,
        "y": 100
    },
    {
        "id": "debug_recording",
        "type": "debug",
        "z": "tab_button_handler",
        "name": "Recording",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 650,
        "y": 140
    },
    {
        "id": "debug_other",
        "type": "debug",
        "z": "tab_button_handler",
        "name": "Other Buttons",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 660,
        "y": 180
    },
    {
        "id": "comment_buttons",
        "type": "comment",
        "z": "tab_button_handler",
        "name": "Button Press Handler - Process camera and recording buttons",
        "info": "",
        "x": 260,
        "y": 80
    },
    {
        "id": "tab_rotary",
        "type": "tab",
        "label": "Smartpanel - Rotary Encoder",
        "disabled": false,
        "info": "# Rotary Encoder Handler\n\nDemonstrates:\n- Rotary encoder position tracking\n- Audio level control\n- Direction detection\n- Value normalization"
    },
    {
        "id": "smartpanel_rotary",
        "type": "nmos-smartpanel",
        "z": "tab_rotary",
        "name": "Mixer Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Audio Mixer Panel",
        "deviceDescription": "4-channel audio mixer",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": false,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 250,
        "y": 140
    },
    {
        "id": "func_rotary_handler",
        "type": "function",
        "z": "tab_rotary",
        "name": "Encoder to Audio Level",
        "func": "// Convert rotary encoder to audio level\nif (!msg.smartpanel || !msg.smartpanel.commands) {\n    return null;\n}\n\nfor (const cmd of msg.smartpanel.commands) {\n    if (cmd.type === 'rotary') {\n        // Convert 0-1 position to dB range (-60 to +12 dB)\n        const db = (cmd.position * 72) - 60;\n        \n        msg.payload = {\n            channel: cmd.encoder,\n            level_db: Math.round(db * 10) / 10,\n            level_normalized: cmd.position,\n            direction: cmd.direction || 'none',\n            delta: cmd.delta || 0\n        };\n        msg.topic = `audio/channel/${cmd.encoder}/level`;\n        \n        return msg;\n    }\n}\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 140
    },
    {
        "id": "debug_audio_level",
        "type": "debug",
        "z": "tab_rotary",
        "name": "Audio Level",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 720,
        "y": 140
    },
    {
        "id": "comment_rotary",
        "type": "comment",
        "z": "tab_rotary",
        "name": "Rotary Encoder - Control audio levels with encoders",
        "info": "",
        "x": 240,
        "y": 80
    },
    {
        "id": "tab_button_display",
        "type": "tab",
        "label": "Smartpanel - Button Display",
        "disabled": false,
        "info": "# Button Display Writing\n\nDemonstrates:\n- Single button text update\n- Multiple button updates\n- Dynamic button labels\n- Color coding"
    },
    {
        "id": "smartpanel_display",
        "type": "nmos-smartpanel",
        "z": "tab_button_display",
        "name": "Display Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Display Control Panel",
        "deviceDescription": "Button display writer",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": true,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 520,
        "y": 200
    },
    {
        "id": "inject_single_button",
        "type": "inject",
        "z": "tab_button_display",
        "name": "Set Button 1: REC",
        "props": [
            {
                "p": "action",
                "v": "set_button_text",
                "vt": "str"
            },
            {
                "p": "button",
                "v": "1",
                "vt": "num"
            },
            {
                "p": "text",
                "v": "REC",
                "vt": "str"
            },
            {
                "p": "color",
                "v": "red",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 190,
        "y": 140
    },
    {
        "id": "inject_multiple_buttons",
        "type": "inject",
        "z": "tab_button_display",
        "name": "Set Camera Buttons",
        "props": [
            {
                "p": "action",
                "v": "set_multiple_buttons",
                "vt": "str"
            },
            {
                "p": "buttons",
                "v": "[{\"button\":1,\"text\":\"CAM 1\",\"color\":\"green\"},{\"button\":2,\"text\":\"CAM 2\",\"color\":\"white\"},{\"button\":3,\"text\":\"CAM 3\",\"color\":\"white\"},{\"button\":4,\"text\":\"CAM 4\",\"color\":\"white\"}]",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 200,
        "y": 180
    },
    {
        "id": "func_dynamic_labels",
        "type": "function",
        "z": "tab_button_display",
        "name": "Dynamic Camera Labels",
        "func": "// Simulate camera availability status\nconst cameras = [\n    { id: 1, name: 'CAM 1', online: true },\n    { id: 2, name: 'CAM 2', online: true },\n    { id: 3, name: 'CAM 3', online: false },\n    { id: 4, name: 'CAM 4', online: true }\n];\n\n// Build button updates\nmsg = {\n    action: 'set_multiple_buttons',\n    buttons: cameras.map(cam => ({\n        button: cam.id,\n        text: cam.name,\n        color: cam.online ? 'green' : 'amber'\n    }))\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 220
    },
    {
        "id": "inject_dynamic",
        "type": "inject",
        "z": "tab_button_display",
        "name": "Update Status",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 260
    },
    {
        "id": "func_production_labels",
        "type": "function",
        "z": "tab_button_display",
        "name": "Production Panel Labels",
        "func": "// Setup production control panel\nconst buttons = [\n    { button: 1, text: 'CAM 1', color: 'white' },\n    { button: 2, text: 'CAM 2', color: 'white' },\n    { button: 3, text: 'CAM 3', color: 'white' },\n    { button: 4, text: 'CAM 4', color: 'white' },\n    { button: 5, text: 'REC', color: 'red' },\n    { button: 6, text: 'STOP', color: 'amber' },\n    { button: 7, text: 'PREV', color: 'green' },\n    { button: 8, text: 'PGM', color: 'red' }\n];\n\nmsg = {\n    action: 'set_multiple_buttons',\n    buttons: buttons\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 300
    },
    {
        "id": "comment_display",
        "type": "comment",
        "z": "tab_button_display",
        "name": "Button Display Writing - Send text and colors to Smartpanel buttons",
        "info": "",
        "x": 270,
        "y": 80
    },
    {
        "id": "tab_feedback",
        "type": "tab",
        "label": "Smartpanel - Feedback Loop",
        "disabled": false,
        "info": "# Button Feedback Loop\n\nDemonstrates:\n- Button press detection\n- Immediate button label update\n- State management\n- Bidirectional communication"
    },
    {
        "id": "smartpanel_feedback",
        "type": "nmos-smartpanel",
        "z": "tab_feedback",
        "name": "Interactive Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Interactive Smartpanel",
        "deviceDescription": "Bidirectional control panel",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": true,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 280,
        "y": 160
    },
    {
        "id": "func_button_feedback",
        "type": "function",
        "z": "tab_feedback",
        "name": "Button Press Feedback",
        "func": "// When button pressed, update its label\nif (!msg.smartpanel || !msg.smartpanel.commands) {\n    return null;\n}\n\nfor (const cmd of msg.smartpanel.commands) {\n    if (cmd.type === 'button' && cmd.pressed) {\n        // Get current state from flow context\n        let selectedCamera = flow.get('selectedCamera') || 0;\n        \n        if (cmd.button >= 1 && cmd.button <= 4) {\n            // Camera button pressed\n            selectedCamera = cmd.button;\n            flow.set('selectedCamera', selectedCamera);\n            \n            // Update all camera buttons\n            const buttons = [];\n            for (let i = 1; i <= 4; i++) {\n                buttons.push({\n                    button: i,\n                    text: `CAM ${i}`,\n                    color: i === selectedCamera ? 'red' : 'white'\n                });\n            }\n            \n            msg = {\n                action: 'set_multiple_buttons',\n                buttons: buttons\n            };\n            return msg;\n        }\n        else if (cmd.button === 5) {\n            // Record button\n            const recording = flow.get('recording') || false;\n            flow.set('recording', !recording);\n            \n            msg = {\n                action: 'set_button_text',\n                button: 5,\n                text: !recording ? 'STOP' : 'REC',\n                color: !recording ? 'red' : 'green'\n            };\n            return msg;\n        }\n    }\n}\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 160
    },
    {
        "id": "inject_init_feedback",
        "type": "inject",
        "z": "tab_feedback",
        "name": "Initialize Panel",
        "props": [
            {
                "p": "action",
                "v": "set_multiple_buttons",
                "vt": "str"
            },
            {
                "p": "buttons",
                "v": "[{\"button\":1,\"text\":\"CAM 1\",\"color\":\"white\"},{\"button\":2,\"text\":\"CAM 2\",\"color\":\"white\"},{\"button\":3,\"text\":\"CAM 3\",\"color\":\"white\"},{\"button\":4,\"text\":\"CAM 4\",\"color\":\"white\"},{\"button\":5,\"text\":\"REC\",\"color\":\"green\"}]",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "2",
        "topic": "",
        "x": 180,
        "y": 120
    },
    {
        "id": "debug_feedback",
        "type": "debug",
        "z": "tab_feedback",
        "name": "Commands",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "smartpanel.commands",
        "targetType": "msg",
        "x": 500,
        "y": 220
    },
    {
        "id": "comment_feedback",
        "type": "comment",
        "z": "tab_feedback",
        "name": "Feedback Loop - Button press updates button labels immediately",
        "info": "",
        "x": 260,
        "y": 60
    },
    {
        "id": "tab_multi_camera",
        "type": "tab",
        "label": "Smartpanel - Multi-Camera Production",
        "disabled": false,
        "info": "# Multi-Camera Production Example\n\nComplete production workflow:\n- 4 camera selection buttons\n- Recording control\n- Tally light feedback\n- Program/Preview selection\n- Dynamic button labels"
    },
    {
        "id": "smartpanel_production",
        "type": "nmos-smartpanel",
        "z": "tab_multi_camera",
        "name": "Production Panel",
        "registry": "",
        "mqttBroker": "mqtt://localhost:1883",
        "mqttQos": 0,
        "deviceLabel": "Multi-Camera Production",
        "deviceDescription": "4-camera production switcher",
        "subscriptionFilter": "x-nmos/events/1.0/+/+",
        "enableButtonDisplay": true,
        "autoParseCommands": true,
        "nodeId": "",
        "deviceId": "",
        "sourceId": "",
        "receiverId": "",
        "x": 290,
        "y": 200
    },
    {
        "id": "func_production_logic",
        "type": "function",
        "z": "tab_multi_camera",
        "name": "Production Logic",
        "func": "// Complete production switcher logic\nif (!msg.smartpanel || !msg.smartpanel.commands) {\n    return [null, null, null];\n}\n\nfor (const cmd of msg.smartpanel.commands) {\n    if (cmd.type === 'button' && cmd.pressed) {\n        const button = cmd.button;\n        \n        // Camera buttons (1-4)\n        if (button >= 1 && button <= 4) {\n            const prevProgram = flow.get('programCamera') || 0;\n            flow.set('previewCamera', button);\n            \n            msg.payload = {\n                action: 'preview_select',\n                camera: button,\n                previous: prevProgram\n            };\n            msg.topic = 'production/preview';\n            return [msg, null, null];\n        }\n        // TAKE button (5) - Move preview to program\n        else if (button === 5) {\n            const preview = flow.get('previewCamera') || 1;\n            const prevProgram = flow.get('programCamera') || 0;\n            flow.set('programCamera', preview);\n            \n            msg.payload = {\n                action: 'take',\n                from: prevProgram,\n                to: preview\n            };\n            msg.topic = 'production/take';\n            return [null, msg, null];\n        }\n        // REC button (6)\n        else if (button === 6) {\n            const recording = flow.get('recording') || false;\n            flow.set('recording', !recording);\n            \n            msg.payload = {\n                action: recording ? 'stop_recording' : 'start_recording',\n                program_camera: flow.get('programCamera') || 1\n            };\n            msg.topic = 'production/recording';\n            return [null, null, msg];\n        }\n    }\n    // Handle tally from switcher\n    else if (cmd.type === 'tally') {\n        msg.payload = {\n            tally: cmd.color,\n            state: cmd.state\n        };\n        msg.topic = 'production/tally';\n        return [msg, null, null];\n    }\n}\n\nreturn [null, null, null];",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 200
    },
    {
        "id": "func_update_panel",
        "type": "function",
        "z": "tab_multi_camera",
        "name": "Update Panel Labels",
        "func": "// Update panel based on production state\nconst program = flow.get('programCamera') || 1;\nconst preview = flow.get('previewCamera') || 2;\nconst recording = flow.get('recording') || false;\n\nconst buttons = [];\n\n// Camera buttons (1-4)\nfor (let i = 1; i <= 4; i++) {\n    let color = 'white';\n    if (i === program) color = 'red';      // Program\n    else if (i === preview) color = 'green'; // Preview\n    \n    buttons.push({\n        button: i,\n        text: `CAM ${i}`,\n        color: color\n    });\n}\n\n// TAKE button (5)\nbuttons.push({\n    button: 5,\n    text: 'TAKE',\n    color: 'amber'\n});\n\n// REC button (6)\nbuttons.push({\n    button: 6,\n    text: recording ? 'â—REC' : 'REC',\n    color: recording ? 'red' : 'white'\n});\n\nmsg = {\n    action: 'set_multiple_buttons',\n    buttons: buttons\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 280
    },
    {
        "id": "inject_init_production",
        "type": "inject",
        "z": "tab_multi_camera",
        "name": "Initialize",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "2",
        "topic": "",
        "x": 150,
        "y": 140
    },
    {
        "id": "inject_update_panel",
        "type": "inject",
        "z": "tab_multi_camera",
        "name": "Update",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 140,
        "y": 280
    },
    {
        "id": "debug_preview",
        "type": "debug",
        "z": "tab_multi_camera",
        "name": "Preview",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 720,
        "y": 160
    },
    {
        "id": "debug_take",
        "type": "debug",
        "z": "tab_multi_camera",
        "name": "Take",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 710,
        "y": 200
    },
    {
        "id": "debug_rec",
        "type": "debug",
        "z": "tab_multi_camera",
        "name": "Recording",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 730,
        "y": 240
    },
    {
        "id": "comment_production",
        "type": "comment",
        "z": "tab_multi_camera",
        "name": "Multi-Camera Production - Complete production switcher workflow",
        "info": "",
        "x": 270,
        "y": 80
    },
    {
        "id": "func_init_state",
        "type": "function",
        "z": "tab_multi_camera",
        "name": "Initialize State",
        "func": "// Initialize flow context\nflow.set('programCamera', 1);\nflow.set('previewCamera', 2);\nflow.set('recording', false);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 140
    }
]
